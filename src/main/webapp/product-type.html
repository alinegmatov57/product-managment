<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Types</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="mb-4">Product Types</h2>
  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">+ Add Product Type</button>
  <table class="table table-bordered bg-white shadow-sm">
    <thead class="table-dark">
    <tr>
      <th>ID</th>
      <th>Type Name</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody id="typeTableBody"></tbody>
  </table>
</div>

<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="addForm">
        <div class="modal-header">
          <h5 class="modal-title">Add Product Type</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="text" class="form-control" id="typeName" placeholder="Type name" required>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Add</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const API_URL = '/api/product-types';
  const token = localStorage.getItem("token");
  if (!token) location.href = "index.html";

  const loadTypes = () => {
    fetch(API_URL, {
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
            .then(res => res.json())
            .then(data => {
              const list = data.data || [];
              const body = document.getElementById('typeTableBody');
              body.innerHTML = '';
              list.forEach(type => {
                body.innerHTML += `
            <tr>
              <td>${type.id}</td>
              <td>${type.typeName}</td>
              <td>
                <button class="btn btn-sm btn-warning me-2" onclick="editType(${type.id}, '${type.typeName}')">Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteType(${type.id})">Delete</button>
              </td>
            </tr>`;
              });
            });
  };

  document.getElementById('addForm').addEventListener('submit', function (e) {
    e.preventDefault();
    const name = document.getElementById('typeName').value.trim();
    if (!name) return;

    fetch(API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify({typeName: name})
    })
            .then(res => res.json())
            .then(data => {
              if (data.success) {
                const modal = bootstrap.Modal.getInstance(document.getElementById('addModal'));
                modal.hide();
                this.reset();
                loadTypes();
              } else {
                alert(data.message || "Error adding type");
              }
            });
  });

  function deleteType(id) {
    if (!confirm('Are you sure you want to delete this type?')) return;

    fetch(`${API_URL}/${id}`, {
      method: 'DELETE',
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
            .then(res => res.json())
            .then(data => {
              if (data.success) loadTypes();
              else alert(data.message || 'Delete failed');
            });
  }

  function editType(id, oldName) {
    const newName = prompt("Enter new type name:", oldName);
    if (!newName || newName.trim() === oldName) return;

    fetch(`${API_URL}/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      },
      body: JSON.stringify({typeName: newName.trim()})
    })
            .then(res => res.json())
            .then(data => {
              if (data.success) loadTypes();
              else alert(data.message || 'Update failed');
            });
  }

  window.onload = loadTypes;
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
